var app = angular.module('myapp', ['ngRoute','ngMessages']);

app.config(function($routeProvider){
	$routeProvider.when('/',{
		templateUrl:'view/table.html',
        controller:'tab_ctrl'
	});
	$routeProvider.when('/card',{
		templateUrl:'view/cards.html',
        controller:'card_ctrl'
    });
	$routeProvider.when('/register',{
		templateUrl:'view/registration1.html',
        controller:'form_ctrl'
	});
    $routeProvider.when('/view',{
		templateUrl:'view/view_user.html',
        controller:'view_ctrl'
	});
	$routeProvider.otherwise({
		redirectTo:'/'
	});
});

app.controller('card_ctrl',function($scope,$http){

   $scope.getcontacts=function(){
   $http({
			url:'https://zenways-contact.herokuapp.com/api/contacts',
			headers:{
				key:'ZENWAYS01PIET01'
			}
		}).then(function(response){
			console.log(response);
			if(response.data.status){
				$scope.contacts=response.data.contacts;
			}else{
				alert(response.data.error);
			}
		},function(response){
			console.log(response);
			alert('Something went wrong!');
		});
   }
 $scope.getcontacts();    
});
app.controller('form_ctrl',function($scope,$http,$q,$location,$rootScope){  
    
   $scope.submitform=function(){
       console.log($rootScope.contact);
          $http({
			url:'https://zenways-contact.herokuapp.com/api/contact',
			headers:{
				key:'ZENWAYS01PIET01'
			},
			data:$rootScope.contact,
			method:'POST'
		}).then(function(response){
			if(response.data.status){
				alert('User was successfully Inserted');
                 $location.path('/');
			}else{
				alert(response.data.error);
			}
		},function(response){
			console.log(response);
			alert('Something went wrong!');
              $location.path('/');
		}); 
       console.log("Form Submitted");
      
     }
      $scope.update_contact=function(){
          console.log('https://zenways-contact.herokuapp.com/api/contact/'+$rootScope.contact._id);
          $http({
			url:'https://zenways-contact.herokuapp.com/api/contact/'+$rootScope.contact._id,
			headers:{
				key:'ZENWAYS01PIET01'
			},
			data:$rootScope.contact,
			method:'PUT'
		}).then(function(response){
               console.log(response);
              alert("contact updated");
              $location.path('/');
           },function(response){
               console.log(response);
              alert("error");
           });
          
}
});
app.controller('tab_ctrl',function($scope,$http,$q,$location,$rootScope){

$scope.edit_contact=function(obj){
$rootScope.contact=obj;
$location.path('/register');
   }

$scope.view_data=function(obj){
    $rootScope.id=obj._id;
    $location.path('/view');
}

$scope.delete_contact=function(obj){
     $http({
			url:'https://zenways-contact.herokuapp.com/api/contact/'+obj._id,
			headers:{
				key:'ZENWAYS01PIET01'
			},
			method:'DELETE'
		}).then(function(response){
			if(response.data.status){
				alert('User Successfully Deleted');
				$scope.getname();
                $rootScope.contact={};
			}else{
				alert(response.data.error);
			}
		},function(response){
			console.log(response);
			alert('Cannot Delete');
		}); 
      }

   $scope.getname=function(){
   $http({
			url:'https://zenways-contact.herokuapp.com/api/contacts',
			headers:{
				key:'ZENWAYS01PIET01'
			}
		}).then(function(response){
			console.log(response);
			if(response.data.status){
				$scope.contacts=response.data.contacts;
			}else{
				alert(response.data.error);
			}
		},function(response){
			console.log(response);
			alert('Something went wrong!');
		});
   }
 $scope.getname();
});

app.controller('view_ctrl',function($routeParams,$scope,$location,$rootScope,$http){

$scope.view_user=function(id){
    $http({
        url:'https://zenways-contact.herokuapp.com/api/contact/'+id,
        headers:{
            key:'ZENWAYS01PIET01'
        }
    }).then(function(response){
        if(response.data.status)
            {
        $scope.user_data=response.data.contact;
        $scope.user_data.location="https://maps.googleapis.com/maps/api/staticmap?center="+$scope.user_data.address.split(' ').join('+')+"zoom=12&scale=2&size=400x300&markers=%7C"+$scope.user_data.address.split(' ').join('+')+"&key=AIzaSyB09AhhBd8ojB0CMpjDFimsebAVA3XVZX8";
        console.log($scope.user_data.location);
        $scope.user_data.dir='https://www.google.com/maps/dir//'+$scope.user_data.address.split(' ').join('+')+'/';
            }
        else{
            $location.path('/');
        }
        },function(response){
            console.log(response);
            alert("can not load contact");
        })
    
}
$scope.user=$rootScope.id;
$scope.view_user($scope.user);
    
$scope.back=function(){
    $location.path('/');
}
});